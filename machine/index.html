
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>Machine - PSFMachine</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PSFMachine" class="md-header__button md-logo" aria-label="PSFMachine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m5.8 21 1.6-7L2 9.2l7.2-.6L12 2l2.8 6.6 7.2.6-3.2 2.8H18c-3.1 0-5.6 2.3-6 5.3L5.8 21M17 14v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PSFMachine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Machine
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/SSDataLab/psfmachine/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PSFMachine" class="md-nav__button md-logo" aria-label="PSFMachine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m5.8 21 1.6-7L2 9.2l7.2-.6L12 2l2.8 6.6 7.2.6-3.2 2.8H18c-3.1 0-5.6 2.3-6 5.3L5.8 21M17 14v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2z"/></svg>

    </a>
    PSFMachine
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/SSDataLab/psfmachine/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Machine
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Machine
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine" class="md-nav__link">
    psfmachine.machine.Machine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.build_shape_model" class="md-nav__link">
    build_shape_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.build_time_model" class="md-nav__link">
    build_time_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.compute_aperture_photometry" class="md-nav__link">
    compute_aperture_photometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.create_aperture_mask" class="md-nav__link">
    create_aperture_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.fit_model" class="md-nav__link">
    fit_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.plot_shape_model" class="md-nav__link">
    plot_shape_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.plot_time_model" class="md-nav__link">
    plot_time_model()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpf/" class="md-nav__link">
        TPFMachine
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ffi/" class="md-nav__link">
        FFIMachine
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../aperture/" class="md-nav__link">
        Aperture Photometry
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine" class="md-nav__link">
    psfmachine.machine.Machine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.build_shape_model" class="md-nav__link">
    build_shape_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.build_time_model" class="md-nav__link">
    build_time_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.compute_aperture_photometry" class="md-nav__link">
    compute_aperture_photometry()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.create_aperture_mask" class="md-nav__link">
    create_aperture_mask()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.fit_model" class="md-nav__link">
    fit_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.plot_shape_model" class="md-nav__link">
    plot_shape_model()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#psfmachine.machine.Machine.plot_time_model" class="md-nav__link">
    plot_time_model()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SSDataLab/psfmachine/edit/master/docs/machine.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="documentation-for-machine">Documentation for <code>Machine</code></h1>


  <div class="doc doc-object doc-class">

<a id="psfmachine.machine.Machine"></a>
    <div class="doc doc-contents first">

      <p>Class for calculating fast PRF photometry on a collection of images and</p>
<p>a list of in image sources.</p>
<p>This method is discussed in detail in
<a href="https://ui.adsabs.harvard.edu/abs/2021arXiv210608411H/abstract">Hedges et al. 2021</a>.</p>
<p>This method solves a linear model to assuming Gaussian priors on the weight of
each linear components as explained by
<a href="https://ui.adsabs.harvard.edu/abs/2017RNAAS...1....7L/abstract">Luger, Foreman-Mackey &amp; Hogg, 2017</a></p>




  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">limit_radius</span><span class="o">=</span><span class="mf">24.0</span><span class="p">,</span> <span class="n">time_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_r_knots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_phi_knots</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">n_time_knots</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_time_points</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">time_radius</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">cut_r</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">sparse_dist_lim</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>time</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Time values in JD</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>flux</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Flux values at each pixels and times in units of electrons / sec</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>flux_err</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Flux error values at each pixels and times in units of electrons / sec</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>ra</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Right Ascension coordinate of each pixel</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dec</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Declination coordinate of each pixel</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>sources</code></td>
        <td><code>pandas.DataFrame</code></td>
        <td><p>DataFrame with source present in the images</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>column</code></td>
        <td><code>np.ndarray</code></td>
        <td><p>Data array containing the "columns" of the detector that each pixel is on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>row</code></td>
        <td><code>np.ndarray</code></td>
        <td><p>Data array containing the "rows" of the detector that each pixel is on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>limit_radius</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Radius limit in arcsecs to select stars to be used for PRF modeling</p></td>
        <td><code>24.0</code></td>
      </tr>
      <tr>
        <td><code>time_mask</code></td>
        <td><code>np.ndarray of booleans</code></td>
        <td><p>A boolean array of shape time. Only values where this mask is <code>True</code>
will be used to calculate the average image for fitting the PSF.
Use this to e.g. select frames with low VA, or no focus change</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>n_r_knots</code></td>
        <td><code>int</code></td>
        <td><p>Number of radial knots in the spline model.</p></td>
        <td><code>10</code></td>
      </tr>
      <tr>
        <td><code>n_phi_knots</code></td>
        <td><code>int</code></td>
        <td><p>Number of azimuthal knots in the spline model.</p></td>
        <td><code>15</code></td>
      </tr>
      <tr>
        <td><code>n_time_points</code></td>
        <td><code>int</code></td>
        <td><p>Number of time points to bin by when fitting for velocity aberration.</p></td>
        <td><code>200</code></td>
      </tr>
      <tr>
        <td><code>time_radius</code></td>
        <td><code>float</code></td>
        <td><p>The radius around sources, out to which the velocity aberration model
will be fit. (arcseconds)</p></td>
        <td><code>8</code></td>
      </tr>
      <tr>
        <td><code>rmin</code></td>
        <td><code>float</code></td>
        <td><p>The minimum radius for the PRF model to be fit. (arcseconds)</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>rmax</code></td>
        <td><code>float</code></td>
        <td><p>The maximum radius for the PRF model to be fit. (arcseconds)</p></td>
        <td><code>16</code></td>
      </tr>
      <tr>
        <td><code>sparse_dist_lim</code></td>
        <td><code>float</code></td>
        <td><p>Radial distance used to include pixels around sources when creating delta
arrays (dra, ddec, r, and phi) as sparse matrices for efficiency.
Default is 40" (recommended for kepler). (arcseconds)</p></td>
        <td><code>40</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>nsources</code></td>
        <td><code>int</code></td>
        <td><p>Number of sources to be extracted</p></td>
      </tr>
      <tr>
        <td><code>nt</code></td>
        <td><code>int</code></td>
        <td><p>Number of onservations in the time series (aka number of cadences)</p></td>
      </tr>
      <tr>
        <td><code>npixels</code></td>
        <td><code>int</code></td>
        <td><p>Total number of pixels with flux measurements</p></td>
      </tr>
      <tr>
        <td><code>source_flux_estimates</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>First estimation of pixel fluxes assuming values given by the sources catalog
(e.g. Gaia phot_g_mean_flux)</p></td>
      </tr>
      <tr>
        <td><code>dra</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Distance in right ascension between pixel and source coordinates, units of
degrees</p></td>
      </tr>
      <tr>
        <td><code>ddec</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Distance in declination between pixel and source coordinates, units of
degrees</p></td>
      </tr>
      <tr>
        <td><code>r</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Radial distance between pixel and source coordinates (polar coordinates),
in units of arcseconds</p></td>
      </tr>
      <tr>
        <td><code>phi</code></td>
        <td><code>numpy.ndarray</code></td>
        <td><p>Angle between pixel and source coordinates (polar coordinates),
in units of radians</p></td>
      </tr>
      <tr>
        <td><code>source_mask</code></td>
        <td><code>scipy.sparce.csr_matrix</code></td>
        <td><p>Sparce mask matrix with pixels that contains flux from sources</p></td>
      </tr>
      <tr>
        <td><code>uncontaminated_source_mask</code></td>
        <td><code>scipy.sparce.csr_matrix</code></td>
        <td><p>Sparce mask matrix with selected uncontaminated pixels per source to be used to
build the PSF model</p></td>
      </tr>
      <tr>
        <td><code>mean_model</code></td>
        <td><code>scipy.sparce.csr_matrix</code></td>
        <td><p>Mean PSF model values per pixel used for PSF photometry</p></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.build_shape_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_shape_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flux_cut_off</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Builds a sparse model matrix of shape nsources x npixels to be used when</p>
<p>fitting each source pixels to estimate its PSF photometry</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>flux_cut_off</code></td>
        <td><code>float</code></td>
        <td><p>the flux in COUNTS at which to stop evaluating the model!</p></td>
        <td><code>1</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>None</code></td>
        <td><p>Keyword arguments to be passed to <code>_get_source_mask()</code></p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.build_time_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_time_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Builds a time model that moves the PRF model to account for the scene movement</p>
<p>due to velocity aberration.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>plot</code></td>
        <td><code>boolean</code></td>
        <td><p>Plot a diagnostic figure.</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>None</code></td>
        <td><p>Keyword arguments to be passed to <code>_get_source_mask()</code></p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.compute_aperture_photometry" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_aperture_photometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aperture_size</span><span class="o">=</span><span class="s1">&#39;optimal&#39;</span><span class="p">,</span> <span class="n">target_complete</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">target_crowd</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Computes aperture photometry for all sources in the scene. The aperture shape</p>
<p>follow the PRF profile.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>aperture_size</code></td>
        <td><code>string or int</code></td>
        <td><p>Size of the aperture to be used. If "optimal" the aperture will be optimized
using the flux metric targets. If int between [0, 100], then the boundaries
of the aperture are calculated from the normalized flux value of the given
ith percentile.</p></td>
        <td><code>&#39;optimal&#39;</code></td>
      </tr>
      <tr>
        <td><code>target_complete</code></td>
        <td><code>float</code></td>
        <td><p>Target flux completeness metric (FLFRCSAP) used if aperture_size is
 "optimal".</p></td>
        <td><code>0.9</code></td>
      </tr>
      <tr>
        <td><code>target_crowd</code></td>
        <td><code>float</code></td>
        <td><p>Target flux crowding metric (CROWDSAP) used if aperture_size is "optimal".</p></td>
        <td><code>0.9</code></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.create_aperture_mask" class="doc doc-heading">
<code class="highlight language-python"><span class="n">create_aperture_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Function to create the aperture mask of a given source for a given aperture</p>
<p>size. This function can compute aperutre mask for all sources in the scene.</p>
<p>It creates three new attributes:
    * <code>self.aperture_mask</code> has the aperture mask, shape is [n_surces, n_pixels]
    * <code>self.FLFRCSAP</code> has the completeness metric, shape is [n_sources]
    * <code>self.CROWDSAP</code> has the crowdeness metric, shape is [n_sources]</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>percentile</code></td>
        <td><code>float or list of floats</code></td>
        <td><p>Percentile value that defines the isophote from the distribution
of values in the PRF model of the source. If float, then
all sources will use the same percentile value. If list, then it has to
have lenght that matches <code>self.nsources</code>, then each source has its own
percentile value.</p></td>
        <td><code>50</code></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.fit_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fit_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fit_va</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Finds the best fitting weights for every source, simultaneously</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>fit_va</code></td>
        <td><code>boolean</code></td>
        <td><p>Fitting model accounting for velocity aberration. If <code>True</code>, then a time
model has to be built previously with <code>build_time_model</code>.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.plot_shape_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_shape_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Diagnostic plot of shape model.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>radius</code></td>
        <td><code>float</code></td>
        <td><p>Radius (in arcseconds) limit to be shown in the figure.</p></td>
        <td><code>20</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>matplotlib.Figure</code></td>
      <td><p>Figure.</p></td>
    </tr>
  </tbody>
</table>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="psfmachine.machine.Machine.plot_time_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_time_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Diagnostic plot of time model.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>matplotlib.Figure</code></td>
      <td><p>Figure.</p></td>
    </tr>
  </tbody>
</table>
    </div>

  </div>





  </div>

    </div>

  </div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href=".." class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        <a href="../tpf/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              TPFMachine
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.34eae1b6.min.js"></script>
      
    
  </body>
</html>